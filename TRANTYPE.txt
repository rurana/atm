 IDENTIFICATION DIVISION.
 PROGRAM-ID. TRANTYPE.
 DATA DIVISION.
 
 WORKING-STORAGE SECTION.
 01  WS-CA       PIC X(01).
 01  WS-CHOICE   PIC 9(01) VALUE ZERO.
     88  VALID-CHOICE      VALUE 1 THRU 4.
 01  WS-CHOICE-X REDEFINES WS-CHOICE PIC X(01).
 01  WS-MSG3  PIC X(30) VALUE
     'TRANSACTION CANCELLED!'.
     COPY P26AS07.
     COPY DFHAID.

 LINKAGE SECTION.
 01  DFHCOMMAREA     PIC X(01).

 PROCEDURE DIVISION.
 MAIN-PARA.
     IF EIBCALEN = ZERO
         PERFORM FIRST-PARA
     ELSE
         PERFORM NEXT-PARA.


 END-PARA.
     EXEC CICS RETURN
         TRANSID('P26F')
         COMMAREA(WS-CA)
     END-EXEC.


 FIRST-PARA.
     MOVE LOW-VALUES TO CHOICEO
     PERFORM SEND-MAP.


 SEND-MAP.
     EXEC CICS SEND
         MAP('TRANMAP')
         MAPSET('P26AS07')
         FROM (TRANMAPI)
         ERASE
     END-EXEC.


 NEXT-PARA.
     EVALUATE EIBAID
        WHEN DFHPF3
         EXEC CICS XCTL
	   PROGRAM('ACCTYPE')             
         END-EXEC
        WHEN DFHENTER
            PERFORM PROCESS-PARA
	WHEN ESC
 	    EXEC CICS SEND TEXT
             FROM(WS-MSG3)
             ERASE
         END-EXEC
         EXEC CICS RETURN
         END-EXEC
        WHEN OTHER
            MOVE 'INVALID KEY PRESSED' TO MSG3O
     END-EVALUATE.
     PERFORM SEND-MAP.


 PROCESS-PARA.
     PERFORM RECEIVE-MAP.
     MOVE CHOICEO TO WS-CHOICE-X
     IF VALID-CHOICE
         PERFORM TRANSFER-PARA
     ELSE
         MOVE 'INVALID CHOICE' TO MSG3O
     END-IF.


 TRANSFER-PARA.
     EVALUATE WS-CHOICE
        WHEN 1
           EXEC CICS XCTL
              PROGRAM('WITHDRAW')
           END-EXEC
        WHEN 2
           EXEC CICS XCTL
              PROGRAM('DEPOSIT')
           END-EXEC
        WHEN 3
           EXEC CICS XCTL
              PROGRAM('MINISTMT')
           END-EXEC
        WHEN 4
           EXEC CICS XCTL
              PROGRAM('BALENQ')
           END-EXEC
        WHEN OTHER
           MOVE 'PROGRAM NOT READY' TO MSG3O
     END-EVALUATE.


 RECEIVE-MAP.
     EXEC CICS RECEIVE
         MAP('TRANMAP')
         MAPSET('P26AS07')
         INTO(TRANMAPO)
     END-EXEC.
